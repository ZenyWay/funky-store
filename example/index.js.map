{"version":3,"sources":["node_modules/browser-pack/_prelude.js","dist/index.min.js","dist/utils.js","example/actions.ts","node_modules/basic-fsa-factories/dist/index.min.js","example/effects.ts","example/state.ts","example/index.ts","example/triggers.ts","example/reducers.ts","node_modules/basic-cursors/dist/index.min.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","Array","default","s","Promise","resolve","then","concat","forEach","2","EMPTY_ARRAY","asArray","arrayify","create","keys","createReducer","type","payload","createEffectFactory","concatEffectFactories","push","createTrigger","3","basic_fsa_factories_1","actions","createActionFactories","ANIMATION_FRAME","ANIMATION_FRAME_REQUEST","BALL_BOUNCE","BALL_HIT_BRICK","BALL_STEP","CLICK_CANVAS","CONTROLLER_KEYDOWN","CONTROLLER_KEYUP","GAME_INIT_NEW","GAME_INIT_NEW_BRICKS","GAME_INIT_START","GAME_OVER","GAME_PAUSE","GAME_PLAYER_DOWN","GAME_RUN","PADDLE_STEP","UPDATE_BALL","UPDATE_PADDLE","UPDATE_REPAINT","4","actions_1","state_1","effects","time","requestAnimationFrame","_","[object Object]","ball","bricks","canvas","context","lives","A","message","paddle","l","score","clearRect","width","height","x","y","beginPath","arc","BALL_RADIUS","TWO_PI","fillStyle","fill","closePath","drawBall","rect","HALF_BRICK_WIDTH","HALF_BRICK_HEIGHT","BRICK_WIDTH","BRICK_HEIGHT","drawBricks","HALF_PADDLE_WIDTH","PADDLE_Y","HALF_PADDLE_HEIGHT","PADDLE_WIDTH","PADDLE_HEIGHT","drawPaddle","font","textAlign","fillText","GAME_STATUS_X","GAME_STATUS_Y","drawScore","CANVAS_WIDTH","drawLives","HALF_CANVAS_WIDTH","HALF_CANVAS_HEIGHT","drawMessage","Math","PI","CANVAS_HEIGHT","ControllerState","Idle","Right","Left","Paused","Ready","Running","GameOver","GameState","MAX_LIVES","MESSAGE_ALL_CLEARED","MESSAGE_GAME_OVER","MESSAGE_GAME_PAUSED","CONTROLLER_LEFT_KEYS","CONTROLLER_RIGHT_KEYS","CONTROLLER_KEYS","INITIAL_BALL_VELOCITY_ANGLE","INITIAL_BALL_VELOCITY_MAGNITUDE","INITIAL_BALL_VELOCITY_X","cos","INITIAL_BALL_VELOCITY_Y","sin","BRICK_ROWS","BRICK_COLUMNS","BRICK_Y_OFFSET","BRICK_PADDING","INITIAL_BRICKS","I","unshift","round","getInitialBricks","PADDLE_VELOCITY","effects_1","reducers_1","triggers_1","__1","utils_1","document","createElement","getContext","dispatch","controller","game","debug","console","log","body","appendChild","addEventListener","key","triggers","step","hit","hitHorizontalSegment","dx","index","bounce","hitVerticalSegment","dy","hitBricks","v","hitPaddle","PLAYFIELD","hitPlayfield","updateBall","abs","basic_cursors_1","reducers","propCursor","slice","indexOf","into","max","min","assign"],"mappings":"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","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});const e=new Array,t=t=>e.concat(t||e);function o(t,o,r){let n;const c=e=>{e&&a(e)},s=o(e=>{Promise.resolve(e).then(c)});return a;function a(o){var a;n=t(n,o),s(n,o),(a=r(n,o),e.concat(a||e)).forEach(c)}}exports.default=o;\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lm1pbi5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImUiLCJBcnJheSIsInQiLCJjb25jYXQiLCJvIiwiciIsIm4iLCJjIiwiYSIsInMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInRoZW4iLCJmb3JFYWNoIiwiZGVmYXVsdCJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBQSxDQUFhQSxNQUFBQSxDQUFPQyxjQUFBQSxDQUFlQyxPQUFBQSxDQUFRLFlBQUEsQ0FBYSxDQUFDQyxLQUFBQSxDQUFBQSxDQUFNLENBQUEsQ0FBQSxDQUFBLENBQUssTUFBTUMsQ0FBQUEsQ0FBRSxJQUFJQyxLQUFBQSxDQUFNQyxDQUFBQSxDQUFFQSxDQUFBQSxFQUFHRixDQUFBQSxDQUFFRyxNQUFBQSxDQUFPRCxDQUFBQSxFQUFHRixDQUFBQSxDQUFBQSxDQUFHLFNBQVNJLENBQUFBLENBQUVGLENBQUFBLENBQUVFLENBQUFBLENBQUVDLENBQUFBLENBQUFBLENBQUcsSUFBSUMsQ0FBQUEsQ0FBRSxNQUFNQyxDQUFBQSxDQUFFUCxDQUFBQSxFQUFBQSxDQUFJQSxDQUFBQSxFQUFHUSxDQUFBQSxDQUFFUixDQUFBQSxDQUFBQSxDQUFBQSxDQUFJUyxDQUFBQSxDQUFFTCxDQUFBQSxDQUFFSixDQUFBQSxFQUFBQSxDQUFJVSxPQUFBQSxDQUFRQyxPQUFBQSxDQUFRWCxDQUFBQSxDQUFBQSxDQUFHWSxJQUFBQSxDQUFLTCxDQUFBQSxDQUFBQSxDQUFBQSxDQUFBQSxDQUFLLE9BQU9DLENBQUFBLENBQUUsU0FBU0EsQ0FBQUEsQ0FBRUosQ0FBQUEsQ0FBQUEsQ0FBRyxJQUFJSSxDQUFBQSxDQUFFRixDQUFBQSxDQUFFSixDQUFBQSxDQUFFSSxDQUFBQSxDQUFFRixDQUFBQSxDQUFBQSxDQUFHSyxDQUFBQSxDQUFFSCxDQUFBQSxDQUFFRixDQUFBQSxDQUFBQSxDQUFBQSxDQUFJSSxDQUFBQSxDQUFFSCxDQUFBQSxDQUFFQyxDQUFBQSxDQUFFRixDQUFBQSxDQUFBQSxDQUFHSixDQUFBQSxDQUFFRyxNQUFBQSxDQUFPSyxDQUFBQSxFQUFHUixDQUFBQSxDQUFBQSxFQUFJYSxPQUFBQSxDQUFRTixDQUFBQSxDQUFBQSxDQUFBQSxDQUFJVCxPQUFBQSxDQUFRZ0IsT0FBQUEsQ0FBUVYsQ0FBQUEsQ0FBQUEiLCJzb3VyY2VzQ29udGVudCI6W251bGxdfQ==","\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});const EMPTY_ARRAY=new Array,asArray=t=>EMPTY_ARRAY.concat(t||EMPTY_ARRAY);function createReducer(t,e){const r=arrayify(t);return function(t,c){const{type:o,payload:n}=c;let a=void 0===t?e:t;for(const t of r[o]||EMPTY_ARRAY)a=t(a,n);return a}}function createEffectFactory(t){const e=arrayify(t);return t=>(function(r,c){const{type:o,payload:n}=c;for(const c of e[o]||EMPTY_ARRAY)t(c(r,n))})}function concatEffectFactories(...t){return function(e){const r=new Array;for(const c of t)c&&r.push(c(e));return function(t,e){for(const c of r)c(t,e)}}}function createTrigger(t){return function(e,r){const{type:c,payload:o}=r,n=t[c];return n&&n(e,o)}}function arrayify(t){const e=Object.create(null);for(const r of Object.keys(t))e[r]=asArray(t[r]);return e}exports.createReducer=createReducer,exports.createEffectFactory=createEffectFactory,exports.concatEffectFactories=concatEffectFactories,exports.createTrigger=createTrigger;\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiRU1QVFlfQVJSQVkiLCJBcnJheSIsImFzQXJyYXkiLCJ2YWwiLCJjb25jYXQiLCJjcmVhdGVSZWR1Y2VyIiwic3BlYyIsImluaXQiLCJyZWR1Y2VycyIsImFycmF5aWZ5Iiwic3RhdGUiLCJhY3Rpb24iLCJ0eXBlIiwicGF5bG9hZCIsInJlZHVjZWQiLCJyZWR1Y2VyIiwiY3JlYXRlRWZmZWN0RmFjdG9yeSIsImVmZmVjdHMiLCJkaXNwYXRjaCIsImVmZmVjdCIsImNvbmNhdEVmZmVjdEZhY3RvcmllcyIsImZhY3RvcmllcyIsImZhY3RvcnkiLCJwdXNoIiwiY3JlYXRlVHJpZ2dlciIsInRyaWdnZXJzIiwidHJpZ2dlciIsImVudHJpZXMiLCJkaWN0IiwiY3JlYXRlIiwia2V5Iiwia2V5cyJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBQSxDQUNBQSxNQUFBQSxDQUFPQyxjQUFBQSxDQUFlQyxPQUFBQSxDQUFTLFlBQUEsQ0FBYyxDQUFFQyxLQUFBQSxDQUFBQSxDQUFPLENBQUEsQ0FBQSxDQUFBLENBQ3RELE1BQU1DLFdBQUFBLENBQWMsSUFBSUMsS0FBQUEsQ0FDbEJDLE9BQUFBLENBQVdDLENBQUFBLEVBQVFILFdBQUFBLENBQVlJLE1BQUFBLENBQU9ELENBQUFBLEVBQU9ILFdBQUFBLENBQUFBLENBQ25ELFNBQVNLLGFBQUFBLENBQWNDLENBQUFBLENBQU1DLENBQUFBLENBQUFBLENBQ3pCLE1BQU1DLENBQUFBLENBQVdDLFFBQUFBLENBQVNILENBQUFBLENBQUFBLENBQzFCLE9BQU8sU0FBVUksQ0FBQUEsQ0FBT0MsQ0FBQUEsQ0FBQUEsQ0FDcEIsS0FBQSxDQUFNQyxJQUFBQSxDQUFFQSxDQUFBQSxDQUFJQyxPQUFBQSxDQUFFQSxDQUFBQSxDQUFBQSxDQUFZRixDQUFBQSxDQUMxQixJQUFJRyxDQUFBQSxDQUFBQSxLQUEyQixDQUFBLEdB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","/**\n * @license MIT\n * @author Stephane M. Catala <stephane@zenyway.com>\n *\n * Copyright (C) 2019, Stephane M. Catala <stephane@zenyway.com>\n *\n * Permission is hereby granted, free of charge,\n * to any person obtaining a copy of this software\n * and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction,\n * including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software,\n * and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice\n * shall be included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO\n * THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE\n * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nimport {\n  FactoryAction,\n  createActionFactories,\n  payload as _\n} from 'basic-fsa-factories'\n\nconst actions = createActionFactories({\n  ANIMATION_FRAME: _<number>(),\n  ANIMATION_FRAME_REQUEST: _<void>(),\n  BALL_BOUNCE: _<'x' | 'y'>(),\n  BALL_HIT_BRICK: _<number>(),\n  BALL_STEP: _<{ dx: number; dy: number }>(),\n  CLICK_CANVAS: _<void>(),\n  CONTROLLER_KEYDOWN: _<string>(),\n  CONTROLLER_KEYUP: _<string>(),\n  GAME_INIT_NEW: _<void>(),\n  GAME_INIT_NEW_BRICKS: _<void>(),\n  GAME_INIT_START: _<void>(),\n  GAME_OVER: _<void>(),\n  GAME_PAUSE: _<void>(),\n  GAME_PLAYER_DOWN: _<void>(),\n  GAME_RUN: _<void>(),\n  PADDLE_STEP: _<number>(),\n  UPDATE_BALL: _<number>(),\n  UPDATE_PADDLE: _<number>(),\n  UPDATE_REPAINT: _<void>()\n})\n\nexport type Actions = FactoryAction<typeof actions>\n\nexport default actions\n","\"use strict\";function t(t){const n=Object.create(null);for(const r of Object.keys(t)){const c=t[r];n[r]=e(r,c)}return n}function e(t,e){const n=e=>({type:t,payload:e});return s(e)?n:(...t)=>n(e(...t))}function n(t){const e=Object.keys(t);return function(n){const c=Object.create(null);for(const o of e)c[o]=r(o,t[o])(n);return c}}function r(t,n){return function(r){const c=e(t),o=t=>r(c(t));return s(n)?o:(...t)=>o(n(...t))}}function o(){return c}function c(t){return t}function s(t){return!t||t===c}Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.createActionFactories=t,/* common-shake removed: exports.createActionFactory = */ e,/* common-shake removed: exports.createActionDispatchers = */ n,/* common-shake removed: exports.createActionDispatcher = */ r,exports.payload=o,/* common-shake removed: exports.identity = */ c;\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lm1pbi5qcyJdLCJuYW1lcyI6WyJ0IiwibiIsIk9iamVjdCIsImNyZWF0ZSIsInIiLCJrZXlzIiwibyIsImUiLCJ0eXBlIiwicGF5bG9hZCIsInMiLCJjIiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJjcmVhdGVBY3Rpb25GYWN0b3JpZXMiXSwibWFwcGluZ3MiOiJBQUFBLFlBQUEsQ0FBYSxTQUFTQSxDQUFBQSxDQUFFQSxDQUFBQSxDQUFBQSxDQUFHLE1BQU1DLENBQUFBLENBQUVDLE1BQUFBLENBQU9DLE1BQUFBLENBQU8sSUFBQSxDQUFBLENBQU0sSUFBSSxNQUFNQyxDQUFBQSxJQUFLRixNQUFBQSxDQUFPRyxJQUFBQSxDQUFLTCxDQUFBQSxDQUFBQSxDQUFHLENBQUMsTUFBTU0sQ0FBQUEsQ0FBRU4sQ0FBQUEsQ0FBRUksQ0FBQUEsQ0FBQUEsQ0FBR0gsQ0FBQUEsQ0FBRUcsQ0FBQUEsQ0FBQUEsQ0FBR0csQ0FBQUEsQ0FBRUgsQ0FBQUEsQ0FBRUUsQ0FBQUEsQ0FBQUEsQ0FBRyxPQUFPTCxDQUFBQSxDQUFFLFNBQVNNLENBQUFBLENBQUVQLENBQUFBLENBQUVPLENBQUFBLENBQUFBLENBQUcsTUFBTU4sQ0FBQUEsQ0FBRU0sQ0FBQUEsR0FBRyxDQUFFQyxJQUFBQSxDQUFLUixDQUFBQSxDQUFFUyxPQUFBQSxDQUFRRixDQUFBQSxDQUFBQSxDQUFBQSxDQUFJLE9BQU9HLENBQUFBLENBQUVILENBQUFBLENBQUFBLENBQUdOLENBQUFBLENBQUUsQ0FBQSxHQUFJRCxDQUFBQSxHQUFJQyxDQUFBQSxDQUFFTSxDQUFBQSxDQUFBQSxHQUFLUCxDQUFBQSxDQUFBQSxDQUFBQSxDQUFJLFNBQVNDLENBQUFBLENBQUVELENBQUFBLENBQUFBLENBQUcsTUFBTU8sQ0FBQUEsQ0FBRUwsTUFBQUEsQ0FBT0csSUFBQUEsQ0FBS0wsQ0FBQUEsQ0FBQUEsQ0FBRyxPQUFPLFNBQVNDLENBQUFBLENBQUFBLENBQUcsTUFBTUssQ0FBQUEsQ0FBRUosTUFBQUEsQ0FBT0MsTUFBQUEsQ0FBTyxJQUFBLENBQUEsQ0FBTSxJQUFJLE1BQU1RLENBQUFBLElBQUtKLENBQUFBLENBQUVELENBQUFBLENBQUVLLENBQUFBLENBQUFBLENBQUdQLENBQUFBLENBQUVPLENBQUFBLENBQUVYLENBQUFBLENBQUVXLENBQUFBLENBQUFBLENBQU5QLENBQVVILENBQUFBLENBQUFBLENBQUcsT0FBT0ssQ0FBQUEsQ0FBQUEsQ0FBRyxTQUFTRixDQUFBQSxDQUFFSixDQUFBQSxDQUFFQyxDQUFBQSxDQUFBQSxDQUFHLE9BQU8sU0FBU0csQ0FBQUEsQ0FBQUEsQ0FBRyxNQUFNRSxDQUFBQSxDQUFFQyxDQUFBQSxDQUFFUCxDQUFBQSxDQUFBQSxDQUFHVyxDQUFBQSxDQUFFWCxDQUFBQSxFQUFHSSxDQUFBQSxDQUFFRSxDQUFBQSxDQUFFTixDQUFBQSxDQUFBQSxDQUFBQSxDQUFJLE9BQU9VLENBQUFBLENBQUVULENBQUFBLENBQUFBLENBQUdVLENBQUFBLENBQUUsQ0FBQSxHQUFJWCxDQUFBQSxHQUFJVyxDQUFBQSxDQUFFVixDQUFBQSxDQUFBQSxHQUFLRCxDQUFBQSxDQUFBQSxDQUFBQSxDQUFBQSxDQUFLLFNBQVNNLENBQUFBLEVBQUFBLENBQUksT0FBT0ssQ0FBQUEsQ0FBRSxTQUFTQSxDQUFBQSxDQUFFWCxDQUFBQSxDQUFBQSxDQUFHLE9BQU9BLENBQUFBLENBQUUsU0FBU1UsQ0FBQUEsQ0FBRVYsQ0FBQUEsQ0FBQUEsQ0FBRyxNQUFBLENBQU9BLENBQUFBLEVBQUdBLENBQUFBLEdBQUlXLENBQUFBLENBQUVULE1BQUFBLENBQU9VLGNBQUFBLENBQWVDLE9BQUFBLENBQVEsWUFBQSxDQUFhLENBQUNDLEtBQUFBLENBQUFBLENBQU0sQ0FBQSxDQUFBLENBQUEsQ0FBS0QsT0FBQUEsQ0FBUUUscUJBQUFBLENBQXNCZixDQUFBQSxDQUFFYSwwREFBNEJOLENBQUFBLENBQUVNLDhEQUFnQ1osQ0FBQUEsQ0FBRVksNkRBQStCVCxDQUFBQSxDQUFFUyxPQUFBQSxDQUFRSixPQUFBQSxDQUFRSCxDQUFBQSxDQUFFTywrQ0FBaUJGLENBQUFBLENBQUFBIiwic291cmNlc0NvbnRlbnQiOltudWxsXX0=","/**\n * @license MIT\n * @author Stephane M. Catala <stephane@zenyway.com>\n *\n * Copyright (C) 2019, Stephane M. Catala <stephane@zenyway.com>\n *\n * Permission is hereby granted, free of charge,\n * to any person obtaining a copy of this software\n * and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction,\n * including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software,\n * and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice\n * shall be included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO\n * THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE\n * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nimport actions, { Actions } from './actions'\nimport {\n  BALL_RADIUS,\n  GAME_STATUS_X,\n  GAME_STATUS_Y,\n  HALF_BRICK_HEIGHT,\n  HALF_BRICK_WIDTH,\n  HALF_PADDLE_HEIGHT,\n  HALF_PADDLE_WIDTH,\n  PADDLE_Y,\n  Ball,\n  Brick,\n  Paddle,\n  State,\n  CANVAS_WIDTH,\n  CANVAS_HEIGHT\n} from './state'\nimport { EffectSpecs } from '../dist/utils'\n\nconst effects: Partial<EffectSpecs<State, Actions>> = {\n  ANIMATION_FRAME_REQUEST: ({ time }) =>\n    new Promise<ReturnType<typeof actions.ANIMATION_FRAME>>(resolve =>\n      requestAnimationFrame(current =>\n        resolve(actions.ANIMATION_FRAME(current - time))\n      )\n    ),\n  UPDATE_REPAINT ({\n    ball,\n    bricks,\n    canvas,\n    context,\n    lives,\n    message,\n    paddle,\n    score\n  }) {\n    context.clearRect(0, 0, canvas.width, canvas.height)\n    drawBall(context, ball)\n    drawBricks(context, bricks)\n    drawPaddle(context, paddle)\n    drawScore(context, score)\n    drawLives(context, lives)\n    drawMessage(context, message)\n  }\n}\n\nconst TWO_PI = 2 * Math.PI\nfunction drawBall (context: CanvasRenderingContext2D, { x, y }: Ball) {\n  context.beginPath()\n  context.arc(x, y, BALL_RADIUS, 0, TWO_PI)\n  context.fillStyle = '#0095DD'\n  context.fill()\n  context.closePath()\n}\n\nconst BRICK_WIDTH = 2 * HALF_BRICK_WIDTH\nconst BRICK_HEIGHT = 2 * HALF_BRICK_HEIGHT\nfunction drawBricks (context: CanvasRenderingContext2D, bricks: Brick[]) {\n  for (const { x, y } of bricks) {\n    context.beginPath()\n    context.rect(\n      x - HALF_BRICK_WIDTH,\n      y - HALF_BRICK_HEIGHT,\n      BRICK_WIDTH,\n      BRICK_HEIGHT\n    )\n    context.fillStyle = '#0095DD'\n    context.fill()\n    context.closePath()\n  }\n}\n\nfunction drawLives (context: CanvasRenderingContext2D, lives: number) {\n  context.font = '16px Arial'\n  context.fillStyle = '#0095DD'\n  context.textAlign = 'end'\n  context.fillText(\n    'Lives: ' + lives,\n    CANVAS_WIDTH - GAME_STATUS_X,\n    GAME_STATUS_Y\n  )\n}\n\nconst PADDLE_WIDTH = 2 * HALF_PADDLE_WIDTH\nconst PADDLE_HEIGHT = 2 * HALF_PADDLE_HEIGHT\nfunction drawPaddle (context: CanvasRenderingContext2D, { x }: Paddle) {\n  context.beginPath()\n  context.rect(\n    x - HALF_PADDLE_WIDTH,\n    PADDLE_Y - HALF_PADDLE_HEIGHT,\n    PADDLE_WIDTH,\n    PADDLE_HEIGHT\n  )\n  context.fillStyle = '#0095DD'\n  context.fill()\n  context.closePath()\n}\n\nfunction drawScore (context: CanvasRenderingContext2D, score: number) {\n  context.font = '16px Arial'\n  context.fillStyle = '#0095DD'\n  context.textAlign = 'start'\n  context.fillText('Score: ' + score, GAME_STATUS_X, GAME_STATUS_Y)\n}\n\nconst HALF_CANVAS_HEIGHT = CANVAS_HEIGHT / 2\nconst HALF_CANVAS_WIDTH = CANVAS_WIDTH / 2\n\nfunction drawMessage (\n  context: CanvasRenderingContext2D,\n  message: string | false\n) {\n  if (!message) return\n  context.font = '16px Arial'\n  context.fillStyle = '#0095DD'\n  context.textAlign = 'center'\n  context.fillText(message, HALF_CANVAS_WIDTH, HALF_CANVAS_HEIGHT)\n}\n\nexport default effects\n","/**\n * @license MIT\n * @author Stephane M. Catala <stephane@zenyway.com>\n *\n * Copyright (C) 2019, Stephane M. Catala <stephane@zenyway.com>\n *\n * Permission is hereby granted, free of charge,\n * to any person obtaining a copy of this software\n * and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction,\n * including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software,\n * and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice\n * shall be included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO\n * THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE\n * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nexport interface State extends InitialState {\n  ball: Ball\n  bricks: Brick[]\n  lives: number\n  message: string\n  paddle: Paddle\n  score: number\n  /**\n   * from requestAnimationFrame\n   */\n  time: number\n}\n\nexport interface InitialState {\n  canvas: HTMLCanvasElement\n  context: CanvasRenderingContext2D\n  controller: ControllerState\n  game: GameState\n}\n\nexport interface Ball {\n  x: number\n  y: number\n  v: Velocity\n}\n\n/**\n * grid units / s\n */\nexport interface Velocity {\n  x: number\n  y: number\n}\n\nexport interface Brick {\n  x: number\n  y: number\n}\n\nexport interface Paddle {\n  x: number\n}\n\nexport enum ControllerState {\n  Idle = 'IDLE',\n  Right = 'RIGHT',\n  Left = 'LEFT'\n}\n\nexport enum GameState {\n  Idle = 'IDLE',\n  Paused = 'PAUSED',\n  Ready = 'READY',\n  Running = 'RUNNING',\n  GameOver = 'GAME_OVER'\n}\n\nexport const MAX_LIVES = 3\nexport const MESSAGE_ALL_CLEARED =\n  'All bricks cleared ! Press any key to continue'\nexport const MESSAGE_GAME_OVER = 'Game Over !'\nexport const MESSAGE_GAME_PAUSED = 'Game paused: press any key to start'\nexport const CANVAS_HEIGHT = 480\nexport const CANVAS_WIDTH = 320\nexport const CONTROLLER_LEFT_KEYS = ['Left', 'ArrowLeft']\nexport const CONTROLLER_RIGHT_KEYS = ['Right', 'ArrowRight']\nexport const CONTROLLER_KEYS = CONTROLLER_LEFT_KEYS.concat(\n  CONTROLLER_RIGHT_KEYS\n)\nexport const GAME_STATUS_X = 8\nexport const GAME_STATUS_Y = 20\nexport const BALL_RADIUS = 4\nexport const INITIAL_BALL_VELOCITY_ANGLE = -Math.PI / 3\n/**\n * pixels per seconds\n */\nexport const INITIAL_BALL_VELOCITY_MAGNITUDE = CANVAS_HEIGHT / 2\nexport const INITIAL_BALL_VELOCITY_X =\n  INITIAL_BALL_VELOCITY_MAGNITUDE * Math.cos(INITIAL_BALL_VELOCITY_ANGLE)\nexport const INITIAL_BALL_VELOCITY_Y =\n  INITIAL_BALL_VELOCITY_MAGNITUDE * Math.sin(INITIAL_BALL_VELOCITY_ANGLE)\nexport const BRICK_ROWS = 4\nexport const BRICK_COLUMNS = 5\nexport const BRICK_Y_OFFSET = 32\nexport const BRICK_PADDING = 8\nexport const HALF_BRICK_HEIGHT = 8\nexport const HALF_BRICK_WIDTH =\n  ((CANVAS_WIDTH - BRICK_PADDING) / BRICK_COLUMNS - BRICK_PADDING) / 2\nexport const INITIAL_BRICKS = getInitialBricks()\nexport const HALF_PADDLE_HEIGHT = 4\nexport const HALF_PADDLE_WIDTH = 24\nexport const PADDLE_Y = CANVAS_HEIGHT - HALF_PADDLE_HEIGHT\n/**\n * pixels per seconds\n */\nexport const PADDLE_VELOCITY = CANVAS_WIDTH << 1\n\nfunction getInitialBricks () {\n  const bricks = [] as Brick[]\n  let row = BRICK_ROWS\n  while (row--) {\n    const y =\n      BRICK_Y_OFFSET +\n      HALF_BRICK_HEIGHT +\n      row * (2 * HALF_BRICK_HEIGHT + BRICK_PADDING)\n    let x = CANVAS_WIDTH - BRICK_PADDING - HALF_BRICK_WIDTH\n    while (x > 0) {\n      bricks.unshift({ x: Math.round(x), y: Math.round(y) })\n      x -= 2 * HALF_BRICK_WIDTH + BRICK_PADDING\n    }\n  }\n  return bricks\n}\n","/**\n * @license MIT\n * @author Stephane M. Catala <stephane@zenyway.com>\n *\n * Copyright (C) 2019, Stephane M. Catala <stephane@zenyway.com>\n *\n * Permission is hereby granted, free of charge,\n * to any person obtaining a copy of this software\n * and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction,\n * including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software,\n * and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice\n * shall be included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO\n * THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE\n * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nimport {\n  CANVAS_HEIGHT,\n  CANVAS_WIDTH,\n  ControllerState,\n  GameState,\n  InitialState,\n  State\n} from './state'\nimport actions, { Actions } from './actions'\nimport effects from './effects'\nimport reducers from './reducers'\nimport triggers from './triggers'\nimport createStore from '../'\nimport {\n  concatEffectFactories,\n  createEffectFactory,\n  createReducer,\n  createTrigger\n} from '../dist/utils'\n\nconst canvas = document.createElement('canvas')\ncanvas.height = CANVAS_HEIGHT\ncanvas.width = CANVAS_WIDTH\nconst context = canvas.getContext('2d')\n\nconst dispatch = createStore<State, Actions>(\n  createReducer<State, Actions, InitialState>(reducers, {\n    canvas,\n    context,\n    controller: ControllerState.Idle,\n    game: GameState.Idle\n  }),\n  concatEffectFactories(\n    () => debug, // logs are an effect\n    createEffectFactory(effects)\n  ),\n  createTrigger(triggers)\n)\n\ndocument.body.appendChild(canvas)\ndocument.addEventListener('keydown', ({ key }: KeyboardEvent) =>\n  dispatch(actions.CONTROLLER_KEYDOWN(key))\n)\ndocument.addEventListener('keyup', ({ key }: KeyboardEvent) =>\n  dispatch(actions.CONTROLLER_KEYUP(key))\n)\ncanvas.addEventListener('click', () => dispatch(actions.CLICK_CANVAS()))\n\nfunction debug (state: State, action: Actions) {\n  console.log('ACTION:', action)\n  console.log('STATE:', state)\n}\n","/**\n * @license MIT\n * @author Stephane M. Catala <stephane@zenyway.com>\n *\n * Copyright (C) 2019, Stephane M. Catala <stephane@zenyway.com>\n *\n * Permission is hereby granted, free of charge,\n * to any person obtaining a copy of this software\n * and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction,\n * including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software,\n * and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice\n * shall be included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO\n * THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE\n * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nimport actions, { Actions } from './actions'\nimport {\n  BALL_RADIUS,\n  CANVAS_WIDTH,\n  CANVAS_HEIGHT,\n  HALF_BRICK_HEIGHT,\n  HALF_BRICK_WIDTH,\n  HALF_PADDLE_HEIGHT,\n  HALF_PADDLE_WIDTH,\n  PADDLE_VELOCITY,\n  PADDLE_Y,\n  Ball,\n  Brick,\n  ControllerState,\n  GameState,\n  Paddle,\n  State\n} from './state'\nimport { TriggerSpecs } from '../dist/utils'\n\nconst triggers: Partial<TriggerSpecs<State, Actions>> = {\n  ANIMATION_FRAME: ({ game }, dt) =>\n    game === GameState.Ready\n      ? actions.GAME_RUN() // first call only sets time reference\n      : game === GameState.Running\n      ? [\n          actions.UPDATE_BALL(dt),\n          actions.UPDATE_PADDLE(dt),\n          actions.UPDATE_REPAINT(),\n          actions.ANIMATION_FRAME_REQUEST() // loop\n        ]\n      : actions.UPDATE_REPAINT(), // once\n  BALL_HIT_BRICK: ({ bricks }) => !bricks.length && actions.GAME_OVER(),\n  CLICK_CANVAS: ({ game, lives }) =>\n    game === GameState.Idle || (game === GameState.GameOver && !lives)\n      ? [actions.GAME_INIT_NEW(), actions.GAME_RUN()]\n      : game === GameState.GameOver\n      ? [actions.GAME_INIT_NEW_BRICKS(), actions.GAME_RUN()]\n      : game === GameState.Paused\n      ? actions.GAME_RUN()\n      : actions.GAME_PAUSE(), // Ready or Running\n  GAME_INIT_NEW: () => actions.GAME_INIT_NEW_BRICKS(),\n  GAME_INIT_NEW_BRICKS: () => actions.GAME_INIT_START(),\n  GAME_PLAYER_DOWN: ({ lives }) =>\n    lives\n      ? [actions.GAME_INIT_START(), actions.GAME_PAUSE()]\n      : actions.GAME_OVER(),\n  GAME_RUN: () => actions.ANIMATION_FRAME_REQUEST(),\n  CONTROLLER_KEYDOWN: ({ game }) =>\n    game !== GameState.Ready &&\n    game !== GameState.Running &&\n    actions.CLICK_CANVAS(),\n  UPDATE_BALL ({ ball, bricks, paddle }, dt) {\n    const { step, hit } = updateBall(ball, bricks, paddle, dt)\n    return hit === false\n      ? actions.BALL_STEP(step)\n      : hit.bounce === false\n      ? actions.GAME_PLAYER_DOWN()\n      : [\n          actions.BALL_STEP(step),\n          'index' in hit && actions.BALL_HIT_BRICK(hit.index),\n          actions.BALL_BOUNCE(hit.bounce),\n          actions.UPDATE_BALL(dt - (1000 * step.dy) / ball.v.y)\n        ]\n  },\n  UPDATE_PADDLE: ({ controller }, dt) =>\n    controller !== ControllerState.Idle &&\n    actions.PADDLE_STEP(\n      ((controller === ControllerState.Left ? -dt : dt) * PADDLE_VELOCITY) /\n        1000\n    )\n}\n\nfunction updateBall (\n  ball: Ball,\n  bricks: Brick[],\n  paddle: Paddle,\n  dt: number\n): BallUpdate {\n  let update: BallUpdate = hitBricks(ball, bricks, {\n    dx: (ball.v.x * dt) / 1000,\n    dy: (ball.v.y * dt) / 1000\n  })\n  if (update.hit) return update\n  update = hitPaddle(ball, paddle, update.step)\n  if (update.hit) return update\n  return hitPlayfield(ball, update.step)\n}\n\ninterface BallUpdate {\n  step: Step\n  hit: false | Collision\n}\n\ninterface Step {\n  dx: number\n  dy: number\n}\n\ninterface Collision {\n  /**\n   * false => exit playfield\n   */\n  bounce: false | 'x' | 'y'\n  /**\n   * brick index\n   */\n  index?: number\n}\n\nconst PLAYFIELD = [\n  { bounce: false, x: CANVAS_WIDTH / 2, y: CANVAS_HEIGHT } as const,\n  { bounce: 'y', x: CANVAS_WIDTH / 2, y: 0 } as const,\n  { bounce: 'x', x: 0, y: CANVAS_HEIGHT / 2 } as const,\n  { bounce: 'x', x: CANVAS_WIDTH, y: CANVAS_HEIGHT / 2 } as const\n]\n\nfunction hitPlayfield (ball: Ball, step: Step): BallUpdate {\n  const update: BallUpdate = { step, hit: false }\n  for (const limit of PLAYFIELD) {\n    const { bounce } = limit\n    const hit =\n      bounce === 'x'\n        ? hitVerticalSegment(ball, update.step, {\n            x: limit.x,\n            y: limit.y,\n            dy: Infinity\n          })\n        : hitHorizontalSegment(ball, update.step, {\n            x: limit.x,\n            y: limit.y,\n            dx: Infinity\n          })\n    if (hit !== false) {\n      update.step = hit\n      update.hit = { bounce }\n    }\n  }\n  return update\n}\n\nfunction hitPaddle (ball: Ball, { x }: Paddle, step: Step): BallUpdate {\n  const hit = hitHorizontalSegment(ball, step, {\n    x,\n    y: PADDLE_Y - HALF_PADDLE_HEIGHT,\n    dx: HALF_PADDLE_WIDTH\n  })\n  return hit === false\n    ? { step, hit: false }\n    : { step: hit, hit: { bounce: 'y' } }\n}\n\nfunction hitBricks (ball: Ball, bricks: Brick[], step: Step): BallUpdate {\n  // TODO only run collision checks when ball within or heading towards bricks\n  const update: BallUpdate = { step, hit: false }\n\n  let index = bricks.length\n  while (index--) {\n    const brick = bricks[index]\n    const hitClosestHside = hitHorizontalSegment(ball, update.step, {\n      x: brick.x,\n      y: brick.y - (brick.y < ball.y ? -HALF_BRICK_HEIGHT : HALF_BRICK_HEIGHT),\n      dx: HALF_BRICK_WIDTH\n    })\n    if (hitClosestHside !== false) {\n      update.step = hitClosestHside\n      update.hit = { index, bounce: 'y' }\n    }\n    const hitClosestVside = hitVerticalSegment(ball, update.step, {\n      x: brick.x - (brick.x < ball.x ? -HALF_BRICK_WIDTH : HALF_BRICK_WIDTH),\n      y: brick.y,\n      dy: HALF_BRICK_HEIGHT\n    })\n    if (hitClosestVside !== false) {\n      update.step = hitClosestVside\n      update.hit = { index, bounce: 'x' }\n    }\n  }\n  return update\n}\n\nfunction hitVerticalSegment (\n  ball: { x: number; y: number },\n  step: Step,\n  segment: { x: number; y: number; dy: number }\n): false | Step {\n  // swap x/y\n  const hit = hitHorizontalSegment(\n    { x: ball.y, y: ball.x },\n    { dx: step.dy, dy: step.dx },\n    { x: segment.y, y: segment.x, dx: segment.dy }\n  )\n  return hit && { dx: hit.dy, dy: hit.dx }\n}\n\nfunction hitHorizontalSegment (\n  ball: { x: number; y: number },\n  step: Step,\n  segment: { x: number; y: number; dx: number }\n): false | Step {\n  const d = segment.y - ball.y\n  if (step.dy < 0 ? d < step.dy || d > 0 : d > step.dy || d < 0) {\n    return false // ball is heading away from segment\n  }\n  const dy = d - (d < 0 ? -BALL_RADIUS : BALL_RADIUS)\n  const dx = (dy * step.dx) / step.dy\n  return Math.abs(segment.x + dx - ball.x) <= segment.dx && { dx, dy }\n}\n\nexport default triggers\n","/**\n * @license MIT\n * @author Stephane M. Catala <stephane@zenyway.com>\n *\n * Copyright (C) 2019, Stephane M. Catala <stephane@zenyway.com>\n *\n * Permission is hereby granted, free of charge,\n * to any person obtaining a copy of this software\n * and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction,\n * including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software,\n * and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice\n * shall be included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO\n * THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE\n * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nimport { Actions } from './actions'\nimport {\n  BALL_RADIUS,\n  CANVAS_WIDTH,\n  CONTROLLER_KEYS,\n  CONTROLLER_LEFT_KEYS,\n  CONTROLLER_RIGHT_KEYS,\n  HALF_PADDLE_HEIGHT,\n  INITIAL_BALL_VELOCITY_X,\n  INITIAL_BALL_VELOCITY_Y,\n  INITIAL_BRICKS,\n  MAX_LIVES,\n  MESSAGE_GAME_OVER,\n  MESSAGE_GAME_PAUSED,\n  MESSAGE_ALL_CLEARED,\n  PADDLE_Y,\n  ControllerState,\n  GameState,\n  State\n} from './state'\nimport { into, propCursor as within } from 'basic-cursors'\nimport { ReducerSpecs } from '../dist/utils'\n\nconst reducers: Partial<ReducerSpecs<State, Actions>> = {\n  ANIMATION_FRAME: within('time')((time, dt) => time + dt),\n  BALL_BOUNCE: within('ball')(\n    within('v')(({ x, y }, direction) =>\n      direction === 'x' ? { x: -x, y } : { x, y: -y }\n    )\n  ),\n  BALL_HIT_BRICK: [\n    within('bricks')((bricks, index) =>\n      bricks.slice(0, index).concat(bricks.slice(index + 1))\n    ),\n    within('score')(score => score + 1)\n  ],\n  BALL_STEP: within('ball')(({ x, y, v }, { dx, dy }) => ({\n    x: x + dx,\n    y: y + dy,\n    v\n  })),\n  CONTROLLER_KEYDOWN: within('controller')((state, key) =>\n    CONTROLLER_LEFT_KEYS.indexOf(key) >= 0\n      ? ControllerState.Left\n      : CONTROLLER_RIGHT_KEYS.indexOf(key) >= 0\n      ? ControllerState.Right\n      : state\n  ),\n  CONTROLLER_KEYUP: within('controller')((state, key) =>\n    CONTROLLER_KEYS.indexOf(key) >= 0 ? ControllerState.Idle : state\n  ),\n  GAME_INIT_NEW: [\n    into('lives')(() => MAX_LIVES),\n    into('score')(() => 0),\n    into('time')(() => 0)\n  ],\n  GAME_INIT_NEW_BRICKS: into('bricks')(() => INITIAL_BRICKS),\n  GAME_INIT_START: [\n    into('paddle')(() => ({ x: CANVAS_WIDTH / 2 })),\n    into('ball')(() => ({\n      x: CANVAS_WIDTH / 2,\n      y: PADDLE_Y - HALF_PADDLE_HEIGHT - BALL_RADIUS,\n      v: { x: INITIAL_BALL_VELOCITY_X, y: INITIAL_BALL_VELOCITY_Y }\n    }))\n  ],\n  GAME_OVER: [\n    into('message')(({ lives }) =>\n      !lives ? MESSAGE_GAME_OVER : MESSAGE_ALL_CLEARED\n    ),\n    into('game')(() => GameState.GameOver)\n  ],\n  GAME_PAUSE: [\n    into('message')(() => MESSAGE_GAME_PAUSED),\n    into('game')(() => GameState.Paused)\n  ],\n  GAME_PLAYER_DOWN: within('lives')(lives => lives - 1),\n  GAME_RUN: [\n    into('message')(() => ''),\n    within('game')(game =>\n      game !== GameState.Ready ? GameState.Ready : GameState.Running\n    )\n  ],\n  PADDLE_STEP: within('paddle')(\n    within('x')((x, dx) => Math.max(0, Math.min(CANVAS_WIDTH, x + dx)))\n  )\n}\n\nexport default reducers\n","\"use strict\";function t(t,r=e){return function(n=e){return function(e,...o){const u=t(e),i=n(u,...o);return i===u?e:r(e,i)}}}function n(t){return function(r){return r?r[t]:void 0}}function r(t){return function(r,n){if(r&&r[t]===n&&void 0===n)return r;const e=Object.assign(Object.create(null),r);return e[t]=n,e}}function e(t){return t}Object.defineProperty(exports,\"__esModule\",{value:!0}),/* common-shake removed: exports.default = */ t,exports.propCursor=function(e){return t(n(e),r(e))},exports.into=function(n){return t(e,r(n))},/* common-shake removed: exports.peekProp = */ n,/* common-shake removed: exports.pokeProp = */ r,/* common-shake removed: exports.identity = */ e;\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lm1pbi5qcyJdLCJuYW1lcyI6WyJ0IiwibiIsImUiLCJyIiwibyIsInUiLCJpIiwiT2JqZWN0IiwiYXNzaWduIiwiY3JlYXRlIiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJwcm9wQ3Vyc29yIiwiaW50byJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBQSxDQUFhLFNBQVNBLENBQUFBLENBQUVBLENBQUFBLENBQUVDLENBQUFBLENBQUVDLENBQUFBLENBQUFBLENBQUcsT0FBTyxTQUFTQyxDQUFBQSxDQUFFRCxDQUFBQSxDQUFBQSxDQUFHLE9BQU8sU0FBU0EsQ0FBQUEsQ0FBQUEsR0FBS0UsQ0FBQUEsQ0FBQUEsQ0FBRyxNQUFNQyxDQUFBQSxDQUFFTCxDQUFBQSxDQUFFRSxDQUFBQSxDQUFBQSxDQUFHSSxDQUFBQSxDQUFFSCxDQUFBQSxDQUFFRSxDQUFBQSxDQUFBQSxHQUFLRCxDQUFBQSxDQUFBQSxDQUFHLE9BQU9FLENBQUFBLEdBQUlELENBQUFBLENBQUVILENBQUFBLENBQUVELENBQUFBLENBQUVDLENBQUFBLENBQUVJLENBQUFBLENBQUFBLENBQUFBLENBQUFBLENBQUssU0FBU0wsQ0FBQUEsQ0FBRUQsQ0FBQUEsQ0FBQUEsQ0FBRyxPQUFPLFNBQVNDLENBQUFBLENBQUFBLENBQUcsT0FBT0EsQ0FBQUEsQ0FBRUEsQ0FBQUEsQ0FBRUQsQ0FBQUEsQ0FBQUEsQ0FBQUEsS0FBRyxDQUFBLENBQUEsQ0FBUSxTQUFTRyxDQUFBQSxDQUFFSCxDQUFBQSxDQUFBQSxDQUFHLE9BQU8sU0FBU0MsQ0FBQUEsQ0FBRUUsQ0FBQUEsQ0FBQUEsQ0FBRyxHQUFHRixDQUFBQSxFQUFHQSxDQUFBQSxDQUFFRCxDQUFBQSxDQUFBQSxHQUFLRyxDQUFBQSxFQUFBQSxLQUFHLENBQUEsR0FBU0EsQ0FBQUEsQ0FBRSxPQUFPRixDQUFBQSxDQUFFLE1BQU1DLENBQUFBLENBQUVLLE1BQUFBLENBQU9DLE1BQUFBLENBQU9ELE1BQUFBLENBQU9FLE1BQUFBLENBQU8sSUFBQSxDQUFBLENBQU1SLENBQUFBLENBQUFBLENBQUcsT0FBT0MsQ0FBQUEsQ0FBRUYsQ0FBQUEsQ0FBQUEsQ0FBR0csQ0FBQUEsQ0FBRUQsQ0FBQUEsQ0FBQUEsQ0FBRyxTQUFTQSxDQUFBQSxDQUFFRixDQUFBQSxDQUFBQSxDQUFHLE9BQU9BLENBQUFBLENBQUVPLE1BQUFBLENBQU9HLGNBQUFBLENBQWVDLE9BQUFBLENBQVEsWUFBQSxDQUFhLENBQUNDLEtBQUFBLENBQUFBLENBQU0sQ0FBQSxDQUFBLENBQUEsQ0FBS0QsOENBQWdCWCxDQUFBQSxDQUFFVyxPQUFBQSxDQUFRRSxVQUFBQSxDQUFXLFNBQVNYLENBQUFBLENBQUFBLENBQUcsT0FBT0YsQ0FBQUEsQ0FBRUMsQ0FBQUEsQ0FBRUMsQ0FBQUEsQ0FBQUEsQ0FBR0MsQ0FBQUEsQ0FBRUQsQ0FBQUEsQ0FBQUEsQ0FBQUEsQ0FBQUEsQ0FBS1MsT0FBQUEsQ0FBUUcsSUFBQUEsQ0FBSyxTQUFTYixDQUFBQSxDQUFBQSxDQUFHLE9BQU9ELENBQUFBLENBQUVFLENBQUFBLENBQUVDLENBQUFBLENBQUVGLENBQUFBLENBQUFBLENBQUFBLENBQUFBLENBQUtVLCtDQUFpQlYsQ0FBQUEsQ0FBRVUsK0NBQWlCUixDQUFBQSxDQUFFUSwrQ0FBaUJULENBQUFBLENBQUFBIiwic291cmNlc0NvbnRlbnQiOltudWxsXX0="]}